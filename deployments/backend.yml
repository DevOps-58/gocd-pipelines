format_version: 10
pipelines:
  backend:
    group: App-Deployments
    label_template: "${COUNT}"
    materials:
      mysql-code:
        git: https://github.com/DevOps-58/ansible.git
        branch: main
        auto-update: false
        shallow_clone: true
        display_order: -1
        lock_behaviour: none
    stages:
       - dev:                                        # Name of the stage 
           fetch_materials: true 
           keep_artifacts: false
           clean_workspace: false
           environment_variables:
             ENV: dev
             COMPONENT: backend
           jobs:
             Build:
               tasks:
                 - exec:
                     command: bash 
                     arguments:
                     - init.sh
       - qa:
           approval:
             type: manual
             allow_only_on_success: true
             environment_variables:
               ENV: qa
               COMPONENT: backend
           jobs:
             Build:
               tasks:
                 - exec:
                     command: bash
                     arguments:
                     - init.sh
       - stage:
           approval:
             type: manual
             allow_only_on_success: true
             environment_variables:
               ENV: stage
               COMPONENT: backend
           jobs:
             Build:
               tasks:
                 - exec:
                     command: bash 
                     arguments:
                     - init.sh

       - prod:
           fetch_materials: true 
           keep_artifacts: false
           clean_workspace: false
           environment_variables:
             ENV: prod
             COMPONENT: backend 
           approval:
             type: manual
             allow_only_on_success: true
           jobs:
             Build:
               tasks:
                 - exec:
                     command: bash
                     arguments:
                     - init.sh